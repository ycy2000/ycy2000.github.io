<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UNIPASS 화물 진행정보</title>
<style>
table {
 border-collapse: collapse;
 width: 100%;
 margin-top:10px;
}
th, td {
 border:1px solid #999;
 padding:6px;
 text-align:left;
}
th {
 background:#eee;
}
.btn {display:inline-block;width:60px;height:25px;vertical-align: top;}
#요청결과 > div > div {display:inline-block;border:1px solid black;height:25px;vertical-align: top;margin-right:-1px;margin-bottom:-1px;}
#요청결과 > div > div:nth-child(1) {width:150px;}
#요청결과 > div > div:nth-child(2) {width:150px;}
</style>
</head>
<body>
  <div>
    내 api서버에서 브라우저로 보내는 response객체의 body에 담을 정보
    <button class="btn" onclick="요청보내기(this)">문자열</button>
    <button class="btn" onclick="요청보내기(this)">xml</button>
    <button class="btn" onclick="요청보내기(this)">html</button>
    <button class="btn" onclick="요청보내기(this)">json</button>
  </div>
  <div id="요청결과">
    <div>const res=await fetch(<span id="span받을정보"></span>);</div>
    <div><div>console.log(res) : </div><div id="consolelog_res"></div></div>
    <div><div>response body 정보유형</div><div id="res_text"></div></div>
  </div>



















<h3>UNIPASS 화물 진행정보 조회</h3>

BL번호:
<input id="blno" value="SGN501734600">
년도:
<input id="year" value="2025">

<button onclick="call()">조회</button>

<div id="basic"></div>
<div id="detail"></div>

<script>
async function 요청보내기(요소) {
  const 받을정보유형 =요소.innerHTML;
  document.querySelector('#span받을정보').innerHTML=받을정보유형;
  const res=await fetch('http://localhost:3000/a?받을정보유형='+받을정보유형);
  document.querySelector('#consolelog_res').innerHTML=res;
  document.querySelector('#res_text').innerHTML=res.text(); //promise  객체

  


}
async function call() { 
    const blno = document.getElementById("blno").value;
    const year = document.getElementById("year").value;
    // 이곳이 localhost:3000 이면 http://localhost:3000 생략가능, 현재는 8080;
    const res = await fetch(`http://localhost:3000/unipass?blno=${blno}&year=${year}`);
    const xmlText = await res.text();

    // XML 파싱
    const parser = new DOMParser();
    const xml = parser.parseFromString(xmlText, "text/xml");

    // 기본정보
    const basicNode = xml.getElementsByTagName("cargCsclPrgsInfoQryVo")[0];
    if (!basicNode) {
        document.getElementById("basic").innerHTML = "조회 결과 없음";
        return;
    }

    const fields = ["mblNo","hblNo","prgsStts","shipNm","arvlDt"];
    let basicHtml = "<h4>기본 정보</h4><table><tr>";

    fields.forEach(f => basicHtml += `<th>${f}</th>`);
    basicHtml += "</tr><tr>";

    fields.forEach(f => {
        const v = basicNode.getElementsByTagName(f)[0]?.textContent || "";
        basicHtml += `<td>${v}</td>`;
    });
    basicHtml += "</tr></table>";

    document.getElementById("basic").innerHTML = basicHtml;

    // 진행 이력
    const detailNodes = xml.getElementsByTagName("cargCsclPrgsInfoDtlQryVo");
    let detailHtml = "<h4>진행 이력</h4><table><tr><th>처리일시</th><th>상태</th><th>장소</th></tr>";

    for (let i=0; i<detailNodes.length; i++) {
        const n = detailNodes[i];
        const dttm = n.getElementsByTagName("prcsDttm")[0]?.textContent || "";
        const stts = n.getElementsByTagName("prgsStts")[0]?.textContent || "";
        const place = n.getElementsByTagName("wkngPtNm")[0]?.textContent || "";

        detailHtml += `<tr><td>${dttm}</td><td>${stts}</td><td>${place}</td></tr>`;
    }
    detailHtml += "</table>";

    document.getElementById("detail").innerHTML = detailHtml;
}
</script>

</body>
</html>
